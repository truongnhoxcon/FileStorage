<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real-time Demo - FileStorage</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="css/realtime.css" rel="stylesheet">
    <style>
        .demo-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #f8f9fa;
        }
        .demo-button {
            margin: 5px;
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-connected { background: #4CAF50; }
        .status-disconnected { background: #f44336; }
        .status-connecting { background: #ff9800; }
    </style>
</head>
<body>
    <div class="container mt-4">
        <div class="row">
            <div class="col-12">
                <h1><i class="fas fa-bolt me-2"></i>Real-time Features Demo</h1>
                <p class="text-muted">Demo các tính năng real-time của FileStorage</p>
            </div>
        </div>

        <!-- Connection Status -->
        <div class="demo-section">
            <h3><i class="fas fa-wifi me-2"></i>WebSocket Connection</h3>
            <div class="d-flex align-items-center mb-3">
                <span class="status-indicator" id="connectionStatus"></span>
                <span id="connectionText">Disconnected</span>
            </div>
            <button class="btn btn-primary demo-button" onclick="connectWebSocket()">
                <i class="fas fa-plug me-1"></i>Connect
            </button>
            <button class="btn btn-secondary demo-button" onclick="disconnectWebSocket()">
                <i class="fas fa-unlink me-1"></i>Disconnect
            </button>
        </div>

        <!-- Notifications Demo -->
        <div class="demo-section">
            <h3><i class="fas fa-bell me-2"></i>Notifications Demo</h3>
            <p>Test các loại thông báo real-time:</p>
            <button class="btn btn-success demo-button" onclick="sendTestNotification('success', 'Success Notification', 'This is a success message!')">
                <i class="fas fa-check me-1"></i>Success
            </button>
            <button class="btn btn-info demo-button" onclick="sendTestNotification('info', 'Info Notification', 'This is an info message!')">
                <i class="fas fa-info me-1"></i>Info
            </button>
            <button class="btn btn-warning demo-button" onclick="sendTestNotification('warning', 'Warning Notification', 'This is a warning message!')">
                <i class="fas fa-exclamation me-1"></i>Warning
            </button>
            <button class="btn btn-danger demo-button" onclick="sendTestNotification('error', 'Error Notification', 'This is an error message!')">
                <i class="fas fa-times me-1"></i>Error
            </button>
        </div>

        <!-- File Operations Demo -->
        <div class="demo-section">
            <h3><i class="fas fa-file me-2"></i>File Operations Demo</h3>
            <p>Simulate real-time file operations:</p>
            <button class="btn btn-primary demo-button" onclick="simulateFileUpload()">
                <i class="fas fa-upload me-1"></i>Simulate Upload
            </button>
            <button class="btn btn-info demo-button" onclick="simulateFileDownload()">
                <i class="fas fa-download me-1"></i>Simulate Download
            </button>
            <button class="btn btn-danger demo-button" onclick="simulateFileDelete()">
                <i class="fas fa-trash me-1"></i>Simulate Delete
            </button>
        </div>

        <!-- Chat Demo -->
        <div class="demo-section">
            <h3><i class="fas fa-comments me-2"></i>Real-time Chat Demo</h3>
            <div class="row">
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="chatMessage" class="form-label">Message:</label>
                        <input type="text" class="form-control" id="chatMessage" placeholder="Enter your message...">
                    </div>
                    <button class="btn btn-primary" onclick="sendChatMessage()">
                        <i class="fas fa-paper-plane me-1"></i>Send Message
                    </button>
                </div>
                <div class="col-md-6">
                    <div class="chat-messages" id="chatMessages" style="height: 200px; overflow-y: auto; border: 1px solid #ddd; padding: 10px; background: #f8f9fa;">
                        <div class="text-muted">Chat messages will appear here...</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- User Activity Demo -->
        <div class="demo-section">
            <h3><i class="fas fa-users me-2"></i>User Activity Demo</h3>
            <p>Simulate user activities:</p>
            <button class="btn btn-primary demo-button" onclick="simulateUserLogin()">
                <i class="fas fa-sign-in-alt me-1"></i>User Login
            </button>
            <button class="btn btn-info demo-button" onclick="simulateUserLogout()">
                <i class="fas fa-sign-out-alt me-1"></i>User Logout
            </button>
            <button class="btn btn-warning demo-button" onclick="simulateUserTyping()">
                <i class="fas fa-keyboard me-1"></i>User Typing
            </button>
        </div>

        <!-- System Notifications -->
        <div class="demo-section">
            <h3><i class="fas fa-cog me-2"></i>System Notifications</h3>
            <p>Test system-wide notifications:</p>
            <button class="btn btn-warning demo-button" onclick="sendSystemMaintenance()">
                <i class="fas fa-tools me-1"></i>Maintenance Alert
            </button>
            <button class="btn btn-info demo-button" onclick="sendNewUserAlert()">
                <i class="fas fa-user-plus me-1"></i>New User Alert
            </button>
        </div>

        <!-- Live Data -->
        <div class="demo-section">
            <h3><i class="fas fa-chart-line me-2"></i>Live Data</h3>
            <div class="row">
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-body text-center">
                            <h5 class="card-title">Connected Users</h5>
                            <h2 class="text-primary" id="connectedUsers">0</h2>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-body text-center">
                            <h5 class="card-title">Messages Sent</h5>
                            <h2 class="text-success" id="messagesSent">0</h2>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-body text-center">
                            <h5 class="card-title">File Operations</h5>
                            <h2 class="text-info" id="fileOperations">0</h2>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1.6.1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
    <script src="js/websocket-client.js"></script>
    <script>
        let demoStats = {
            connectedUsers: 0,
            messagesSent: 0,
            fileOperations: 0
        };

        // Override WebSocket client methods for demo
        function connectWebSocket() {
            if (wsClient) {
                wsClient.connect();
                updateConnectionStatus('connecting');
            } else {
                alert('WebSocket client not initialized. Please refresh the page.');
            }
        }

        function disconnectWebSocket() {
            if (wsClient) {
                wsClient.disconnect();
                updateConnectionStatus('disconnected');
            }
        }

        function updateConnectionStatus(status) {
            const statusElement = document.getElementById('connectionStatus');
            const textElement = document.getElementById('connectionText');
            
            statusElement.className = `status-indicator status-${status}`;
            
            switch(status) {
                case 'connected':
                    textElement.textContent = 'Connected';
                    break;
                case 'connecting':
                    textElement.textContent = 'Connecting...';
                    break;
                case 'disconnected':
                    textElement.textContent = 'Disconnected';
                    break;
            }
        }

        function sendTestNotification(type, title, message) {
            showNotification(type, title, message);
        }

        function simulateFileUpload() {
            const fileName = `test-file-${Date.now()}.txt`;
            showNotification('success', 'File Uploaded', `File "${fileName}" has been uploaded successfully`);
            demoStats.fileOperations++;
            updateStats();
        }

        function simulateFileDownload() {
            const fileName = `document-${Date.now()}.pdf`;
            showNotification('info', 'File Downloaded', `File "${fileName}" has been downloaded`);
            demoStats.fileOperations++;
            updateStats();
        }

        function simulateFileDelete() {
            const fileName = `old-file-${Date.now()}.jpg`;
            showNotification('info', 'File Deleted', `File "${fileName}" has been deleted`);
            demoStats.fileOperations++;
            updateStats();
        }

        function sendChatMessage() {
            const messageInput = document.getElementById('chatMessage');
            const message = messageInput.value.trim();
            
            if (message) {
                displayChatMessage('You', message, true);
                messageInput.value = '';
                demoStats.messagesSent++;
                updateStats();
            }
        }

        function displayChatMessage(sender, message, isOwn = false) {
            const chatMessages = document.getElementById('chatMessages');
            const messageElement = document.createElement('div');
            messageElement.className = `chat-message ${isOwn ? 'own' : 'other'}`;
            messageElement.innerHTML = `
                <strong>${sender}:</strong> ${message}
                <small class="d-block text-muted">${new Date().toLocaleTimeString()}</small>
            `;
            
            chatMessages.appendChild(messageElement);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function simulateUserLogin() {
            showNotification('success', 'User Activity', 'User "demo-user" has logged in');
            demoStats.connectedUsers++;
            updateStats();
        }

        function simulateUserLogout() {
            showNotification('info', 'User Activity', 'User "demo-user" has logged out');
            demoStats.connectedUsers = Math.max(0, demoStats.connectedUsers - 1);
            updateStats();
        }

        function simulateUserTyping() {
            showNotification('info', 'User Activity', 'User is typing...');
        }

        function sendSystemMaintenance() {
            showNotification('warning', 'System Maintenance', 'The system will undergo maintenance in 30 minutes. Please save your work.');
        }

        function sendNewUserAlert() {
            showNotification('info', 'New User', 'New user "john_doe" has joined the system');
        }

        function updateStats() {
            document.getElementById('connectedUsers').textContent = demoStats.connectedUsers;
            document.getElementById('messagesSent').textContent = demoStats.messagesSent;
            document.getElementById('fileOperations').textContent = demoStats.fileOperations;
        }

        // Override WebSocket client connection handlers
        const originalOnConnected = WebSocketClient.prototype.onConnected;
        WebSocketClient.prototype.onConnected = function() {
            originalOnConnected.call(this);
            updateConnectionStatus('connected');
        };

        const originalOnDisconnected = WebSocketClient.prototype.onDisconnected;
        WebSocketClient.prototype.onDisconnected = function() {
            originalOnDisconnected.call(this);
            updateConnectionStatus('disconnected');
        };

        // Initialize demo
        document.addEventListener('DOMContentLoaded', function() {
            updateConnectionStatus('disconnected');
            updateStats();
        });
    </script>
</body>
</html>

